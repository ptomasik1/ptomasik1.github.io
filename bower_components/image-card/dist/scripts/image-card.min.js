/**
 * image-card - 0.3.3
 *
 * A Custom Element for an Image Card
 *
 * http://www.emanuel-kluge.de/
 *
 * @element image-card
 * @demo http://herschel666.github.io/image-card/
 *
 * Copyright (c) 2014 Emanuel Kluge;
 * Licensed MIT
 */
!function(a,b,c){function d(){return++t}function e(a){var b,c=getComputedStyle(a),d=c.webkitTransform||c.mozTransform||c.transform,e={x:0,y:0};try{b=/^matrix\(([^)]+)\)$/gi.exec(d)[1].split(/\s?,\s?/)}catch(f){return e}return e.x=parseInt(b[4],10),e.y=parseInt(b[5],10),e}function f(){var a=this.images[this.current-1].naturalWidth,c=this.images[this.current-1].naturalHeight;this.querySelector(".wrapper").style.paddingBottom=c/a*100+"%",this.current>1&&(h.call(this,this.current-1),b.fireEvent(this,"change",{detail:{current:this.current}}))}function g(){for(var a,c=b.createFragment('<div><div class="wrapper"><div class="wrapper-inner"><div class="slider"></div></div></div></div>'),d=c.querySelector(".slider"),e=this.images,f=1;e.length;)a=e[0].cloneNode(!0),a.setAttribute("aria-hidden",f===~~this.current?"false":"true"),a.setAttribute("role","tabpanel"),a.tabIndex=-1,a.id="img-"+this.__id+"-"+f,this.hasAttribute("data-card-control")&&a.setAttribute("aria-labeledby","btn-"+this.__id+"-"+f),d.appendChild(a),e[0].parentNode.removeChild(e[0]),f+=1;return c.childNodes[0].innerHTML}function h(a,b){var c,d,b=b||0;this.__slider&&(c=a*this.offsetWidth,d=Math.abs(a-b)*r,i.call(this,c,d))}function i(a){b.requestFrame(function(){var b=b||r;this.__slider.style.webkitTransitionDuration=b+"s",this.__slider.style.mozTransitionDuration=b+"s",this.__slider.style.transitionDuration=b+"s",this.__slider.style.webkitTransform="translateX(-"+a+"px) translateZ(0)",this.__slider.style.mozTransform="translateX(-"+a+"px) translateZ(0)",this.__slider.style.transform="translateX(-"+a+"px) translateZ(0)",this.__slider.addEventListener(p,function(){this.__slider.style.webkitTransitionDuration=r+"s",this.__slider.style.mozTransitionDuration=r+"s",this.__slider.style.transitionDuration=r+"s"}.bind(this),!1)}.bind(this))}function j(a){s(this.images,function(b,c){b.setAttribute("aria-hidden",c===a?"false":"true")})}function k(a){b.requestFrame(function(){var b=a.pageX-y,c=Math.round(x- -1.3*(b-w)),d=x>=c?"next":"prev",e=Math.abs(c-x)>z*q;return e?(this[d](),void l.call(this,!1)):(this.__slider.style.webkitTransform="translateX("+c+"px) translateZ(0)",this.__slider.style.mozTransform="translateX("+c+"px) translateZ(0)",void(this.__slider.style.transform="translateX("+c+"px) translateZ(0)"))}.bind(this))}function l(a,d){var d=d===c||d;w=null,x=null,y=null,z=null,u&&(b.removeEvent(document.body,u),u=null,b.removeEvent(this,v),v=null,d&&h.call(this,this.current-1,~~this.current))}function m(){for(var a=this;a.parentNode;){if("IMAGE-CARD"===a.parentNode.nodeName)return a.parentNode;a=a.parentNode}return null}function n(a){var b=a.detail.current-1;s(this.buttons,function(a,c){a.classList.remove("current"),a.tabIndex=c===b?0:-1}),this.buttons[b].classList.add("current")}function o(a){this.__parent.current=a.target.getAttribute("data-index")}var p=function(){var a=document.createElement("div").style.webkitTransition;return a!=c?"webkitTransitionEnd":"transitionend"}(),q=.4,r=.15,s=Array.prototype.forEach.call.bind(Array.prototype.forEach),t=0,u=null,v=null,w=null,x=null,y=null,z=null,A=Object.create({lifecycle:Object.create(null),methods:Object.create(null),accessors:Object.create(null),events:Object.create(null)});A.lifecycle.created=function(){this.__id="ic-"+d(),this.current||(this.current=this.current||1),this.setAttribute("role","application"),this.setAttribute("aria-multiselectable","false"),this.querySelector("card-control")&&this.setAttribute("data-card-control",!0),b.innerHTML(this,g.call(this)+this.innerHTML),this.__slider=this.querySelector(".slider"),this.images[this.current-1]&&(this.images[this.current-1].onload=f.bind(this)),this.hasAttribute("data-card-control")||b.addEvents(this,{"keyup:keypass(37, 38)":this.prev.bind(this),"keyup:keypass(39, 40)":this.next.bind(this)}),this.tabIndex=this.hasAttribute("data-card-control")?-1:0},A.lifecycle.attributeChanged=function(a,c,d){"current"===a&&(h.call(this,d-1,c-1),j.call(this,d-1),b.fireEvent(this,"change",{detail:{current:d}}))},A.accessors.images={get:function(){return this.getElementsByTagName("img")}},A.accessors.current={attribute:{name:"current"}},A.events["dragstart:delegate(img)"]=function(a){a.preventDefault()},A.events.mousedown=function(a){y=this.getBoundingClientRect().left,z=this.offsetWidth,w=a.pageX-y,x=e(this.__slider).x,u=b.addEvent(document.body,"mouseup",l.bind(this)),v=b.addEvent(this,"mousemove",k.bind(this))},A.methods.prev=function(){return this.current>1&&(this.current=parseInt(this.current,10)-1),this},A.methods.next=function(){return this.current<this.images.length&&(this.current=parseInt(this.current,10)+1),this},a.ImageCard=b.register("image-card",A);var B=Object.create({lifecycle:Object.create(null),accessors:Object.create(null),events:Object.create(null)});B.lifecycle.created=function(){var a,c=m.call(this);c&&c.__id&&(this.__parent=c,a="",b.addEvent(c,"change",n.bind(this)),b.addEvent(this,"click:delegate(button)",o.bind(this)),s(c.images,function(b,d){var e=d+1,f=e===~~c.current,g=f?" current":"",h=f?"0":"-1";a+='<button type="button" class="btn'+g+'" tabindex="'+h+'" role="tab" aria-controls="img-'+c.__id+"-"+e+'" id="btn-'+c.__id+"-"+e+'" data-index="'+e+'">'+e+"</button>"}),this.innerHTML=a,this.setAttribute("role","tablist"))},B.accessors.buttons={get:function(){return this.getElementsByTagName("button")}},B.events["keyup:keypass(37, 38)"]=function(){this.__parent.prev(),this.buttons[this.__parent.current-1].focus()},B.events["keyup:keypass(39, 40)"]=function(){this.__parent.next(),this.buttons[this.__parent.current-1].focus()},a.CardControl=b.register("card-control",B)}(window,xtag);